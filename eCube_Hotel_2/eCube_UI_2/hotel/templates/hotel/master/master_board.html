{% extends 'hotel/base.html' %}
{% load static %}

{% block header %}
{% endblock %}
{% block content %}

{% if msg %}
    <script type="text/javascript">
    alert("{{ msg }}",1);
    </script>
{% endif %}

<section class="body_contaner no_sidebar">
  <div class="container_content">
    <div class="inner_content_contaner">
      <div class="clearfix marT20"></div>
      <div class="col-md-12">
        <h2 class="pull-left">Board Master</h2>
        <input type="button" name="" id="addNewRecord" onclick="return LoadRecord(event);" class="save_request_button pull-right" value="Add Record" data-toggle="modal" data-target="#Addnew_master">
      </div>
      <div class="clearfix marT10"></div>
      <div class="table-responsive marT20">
        <table id="datavalidation" class="display nowrap custom_table" style="width:100%">
          <thead>
            <tr id="ColumnHead">
          
              <th width="15%">BoardTypecode </th>
              <th width="20%">BoardTypeDescription</th>
              <th width="15%">Status</th>
              <th width="15%">Action</th>
              <th width="15%">Action</th>
           
            </tr>
          </thead>
          <tbody id ="tbl_tbody">
            
          </tbody>
        </table>
      </div>
    </div>
    <div class="clearfix"></div>
  </div>
  
  <!-- /*******************************************/--> 
  <!-- Modal -->
  <div class="modal fade" id="Addnew_master" role="dialog">
    <div class="modal-dialog modal-lg"> 
      
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title" id='h_id'>Add new</h4>
        </div>
        <div class="modal-body">
          <div class="row">
            <div class="col-md-4">
            <form name="AddEditRecord" onsubmit="return addFromValidate();"action="{%url 'master_board' %}" id="AddEditRecord" method="post">{% csrf_token %}
            <table>
            <tr><td></td><td><input type="hidden" class="form-control" id="ed_referenceNo" name="ed_referenceNo" value=""></td></tr>
            <tr><td></td><td><input type="hidden" class="form-control" id="ed_activeValue" name="ed_activeValue" value=""></td></tr>
            <tr><td><label>Board Type Code</label></td><td><input class="form-control" id="ed_BoardCode" name="ed_BoardCode" value=""></td></tr>
            <tr><td><label>Board Type Description</label></td><td><input class="form-control" id="ed_BoardDesc" name="ed_BoardDesc" value=""></td></tr>
            <tr><td><label>Active</label></td><td><input class="form-control" type="checkbox" id="ed_active" name="ed_active" value="Active"></td></tr>
            <tr><td colspan=2><input id="aded_newRecord" class="save_request_button pull-right" type="submit" value="Save"></td></tr>
            </table>
            </form>
      </div>
    </div>
  </div>
</section>
<script src="/static/hotel/js/jquery-1.11.3.min.js"></script>
<script>

  Bind_board_master_name = "{% url 'Bind_board_master_name' %}";
  $(document).ready(function ($) {
    Bind_data_on_page_load();
  });

function Bind_data_on_page_load()
{
  $.ajax({
         url: Bind_board_master_name,
         type: "GET",
         contentType: false,
         beforeSend: function(){ 
           $('.loader_div').show();
           },
         success: function (data) {
          Bind_grid_main(data.board);
         },
         complete:function(data){
            $('.loader_div').hide();
         },
         error: function (xhr, errorType, exception) {
             alert(exception)
         }
     });
}



function Bind_grid_main(data) {
var table = $("#datavalidation").dataTable();
table.fnClearTable();
table.fnDraw();
table.fnDestroy();
var trHTML = '';
var css ='';
$.each(data, function (i, item) {
    css ='green';
    if (item[3]==0)
    {
      css ='red';
    }
    trHTML += '<tr id="trid_'+item[0]+'">'+
              '<td><label id="boardCode_'+item[0]+'">'+item[1]+'</label></td>'+
              '<td><label id="boardDesc_'+item[0]+'">'+item[2]+'</label></td>'+
              '<td><span class="circle '+css+'"><label id="activestatus_'+item[0]+'">'+item[8]+'</label></span></td>'+
              '<td><span class="edit_btn" data-toggle="modal" id="edit_'+item[0]+'" data-target="#Addnew_master" onclick="return LoadRecord(event);">Edit</span></td>'+
              '<td><span class="del_btn" onclick="Delete_main_grp_dtls(' + item[0] + ')">Delete</span></td>' +
              '</tr>';
          
});
$('#tbl_tbody').append(trHTML);
$('#datavalidation').dataTable({
    "sPaginationType": "full_numbers",
    "bFilter": true,
    "bInfo": false,
    "aaSorting":[],
    "bPaginate": true,
    paging: true,
});
$('.dataTables_wrapper,.addhotel_checkbox_contaner').perfectScrollbar();
}


function Delete_main_grp_dtls(id) {
  if (confirm("Are you sure?")) {
      var model={id:id};
        $.ajax({
         url: "{% url 'Delete_Board_master_name' %}",
         type: 'POST',
         data: model,
         dataType: 'json',
         success: function (data) {
             alert('Record deleted successfully ');
             Bind_grid_main(data.board);
         },
         error: function (xhr, errorType, exception) {
             alert(exception)
         }
     });
     }
     return false;
 }


function addFromValidate()
{
  var format = /[!@#$%^&*()+\-=\[\]{};':"\\|,.<>\/?]+/;
  var boardName = document.getElementById('ed_BoardCode').value.length
  var boardVal = document.getElementById('ed_BoardCode').value
  
  
    if (boardName<1 || format.test(boardVal))
    {
        alert("Board Code can not be null or Any Special Character");
        return false;
    }
    if (document.getElementById('ed_BoardDesc').value.length<1)
    {
        alert("Board Description can not be null");
        return false;
    }
     if (document.getElementById('ed_active').checked)
     {
         document.getElementById('ed_activeValue').value="Active";
     }
     else
     {
         document.getElementById('ed_activeValue').value="Inactive";
     }
}

function LoadRecord(e)
{
    if (e.target.id=="addNewRecord")
    {
        document.getElementById('ed_BoardCode').value="";
        document.getElementById('ed_BoardDesc').value="";
        document.getElementById('ed_active').value="";
        document.getElementById('aded_newRecord').value="Add";
        $('#h_id').text('Add New');
    }
    else
    {
        var recordID=e.target.id.split('_').pop();
        var boardCode=document.getElementById('boardCode_'+recordID).innerHTML;
        var boardDesc=document.getElementById('boardDesc_'+recordID).innerHTML;
        var activeFlg=document.getElementById('activestatus_'+recordID).innerHTML;


        if (activeFlg=="Active")
        {
            document.getElementById('ed_active').checked=true;
        }
        else
        {
            document.getElementById('ed_active').checked=false;
        } 

        document.getElementById('ed_BoardCode').value=boardCode;
        document.getElementById('ed_BoardDesc').value=boardDesc;
        document.getElementById('ed_referenceNo').value=recordID;
        document.getElementById('aded_newRecord').value="Edit";
        $('#h_id').text('Edit');
    }
}
</script>
{% endblock %}
